<ng-container *ngIf="headerTemplate; then headerItemTemplate; else headersTemplate"></ng-container>

<ng-template #headerItemTemplate>
  <div class="po-table-headers" [ngStyle]="headerBgColor">
    <ng-container *ngIf="sorted; else headerCustomTemplate">

      <div
        class="po-table-header"
        [class.pointer]="sorted"
        [ngClass]="header.class"
        *ngFor="let header of columns$ | async; trackBy: trackByIndex"
        (click)="sort(header, header.sort)">
        <ng-container
          [ngTemplateOutlet]="headerTemplate"
          [ngTemplateOutletContext]="{ $implicit: header }"
        ></ng-container>
        <div class="sort">
          <label class="desc" *ngIf="header.sort === 'ASC' || !header.sort" (click)="sort(header, 'DESC')"></label>
          <label class="asc" *ngIf="header.sort === 'DESC' || !header.sort" (click)="sort(header, 'ASC')"></label>
        </div>
      </div>
    </ng-container>

    <ng-template #headerCustomTemplate>
      <ng-container *ngFor="let header of columns$ | async; trackBy: trackByIndex">
        <ng-container
            [ngTemplateOutlet]="headerTemplate"
            [ngTemplateOutletContext]="{ $implicit: header }"
          ></ng-container>
      </ng-container>
    </ng-template>
  </div>
</ng-template>

<ng-template #headersTemplate>
  <ng-container [ngTemplateOutlet]="poHeaderTemplate"></ng-container>
</ng-template>

<ng-container *ngIf="rowTemplate && data; then rowItemTemplate; else rowsTemplate"></ng-container>

<ng-template #rowItemTemplate>
  <div class="table-content">
    <ng-container *ngIf="isGroup; else normalTemplate">
      <ng-container *ngFor="let group of data$ | async; let groupIndex = index; trackBy: trackByIndex">
        <div class="row" (click)="group.expandGroup && (group.collapse = !group.collapse)">
          <ng-container
            [ngTemplateOutlet]="groupTemplate"
            [ngTemplateOutletContext]="{ $implicit: group }"
          ></ng-container>
          <ng-container *ngIf="group.expandGroup">
            <label
              [ngClass]="{ asc: group.collapse, desc: !group.collapse }"
              (click)="group.collapse = !group.collapse"
            ></label>
          </ng-container>
        </div>
        <ng-container *ngIf="!group.collapse">
          <div
            class="row"
            [ngClass]="{'inactive': child[inactive], 'hover': mouseHover}"
            *ngFor="let child of group.children; let childIndex = index; trackBy: trackByIndex"
            (click)="rowSelect.emit(child)"
          >
            <ng-container
              [ngTemplateOutlet]="rowTemplate"
              [ngTemplateOutletContext]="{
                $implicit: child,
                rowIndex: childIndex,
                groupLength: group.children.length
              }"
            ></ng-container>
          </div>
        </ng-container>
      </ng-container>
    </ng-container>

    <ng-template #normalTemplate>
      <ng-container *ngFor="let row of data$ | async; let k = index; trackBy: trackByIndex">
        <div class="row" [ngClass]="{'inactive': row[inactive], 'hover': mouseHover}" (click)="rowSelect.emit(row)">
          <ng-container
            [ngTemplateOutlet]="rowTemplate"
            [ngTemplateOutletContext]="{ $implicit: row, rowIndex: k }"
          ></ng-container>
        </div>
      </ng-container>
    </ng-template>
  </div>
</ng-template>

<ng-template #rowsTemplate>
  <ng-container [ngTemplateOutlet]="poTableRowTemplate"></ng-container>
</ng-template>
