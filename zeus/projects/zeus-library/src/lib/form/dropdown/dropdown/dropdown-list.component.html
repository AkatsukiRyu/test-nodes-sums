
<div class="host-control" (click)="toggleDropDownOptions(dropdownControl)" #dropdownControl>
  <input 
    class="ui-po-input" 
    [ngStyle]="{'background': background, color: textColor }" 
    [ngClass]="{ 'text-upper-case sasdasd': !group }" 
    #showSelection type="text" 
    disabled="true" 
    [placeholder]="dropDownPlaceholder" 
  />
  <span class="clear" *ngIf="value && allowedClear" (click)="clearValue()"><i class="fa fa-times"></i></span>
  <span class="drop-icon" [ngStyle]="{'background': background}">
    <div class="ui-po-icon"></div>
  </span>
  <span #toggleOverlay (click)="appendToBody && op.show($event, showSelection)"></span>

  <ng-container *ngIf="!appendToBody">
    <ng-container *ngTemplateOutlet="dropDownTemplate; context: {$implicit: toggleDropdown}"></ng-container>
  </ng-container>
</div>

<p-overlayPanel 
  class="po-dropdown-overlay" 
  #op
  [appendTo]="'body'" 
  [styleClass]="overlayStyleClass"
  [style]="overlayStyle"
  (onShow)="toggleDropdown = true"
  (onHide)="toggleDropdown = false"
>
  <div #wrapperContent>
    <ng-container *ngTemplateOutlet="dropDownTemplate; context: {$implicit: toggleDropdown}"></ng-container>
  </div>
</p-overlayPanel>

<ng-template #dropDownTemplate let-toggle>
  <ng-container *ngIf="dropListCustomTemplate; else defaultTemplate">
    <ng-container *ngIf="toggle" [ngTemplateOutlet]="dropListCustomTemplate"></ng-container>
  </ng-container>

  <ng-template #defaultTemplate>
    <div class="po-dropdown" *ngIf="toggle">
      <div class="search">
        <input #search *ngIf="filter" type="text" [placeholder]="placeholder" [formControl]="searchControl" />
      </div>
      <div class="po-list">
        <ng-container *ngIf="group; then groupTemplate; else itemListTemplate"></ng-container>
      </div>
    </div>
  </ng-template>

</ng-template>

<ng-template #groupTemplate>
  <ul class="group" *ngFor="let option of options$ | async; let i = index; trackBy: trackByIndex" #listItems>
    <div class="group-label item">{{ option[bindingGroupLabel] }}</div>
    <ng-container *ngFor="let item of option[groupItemBinding]; let j = index; trackBy: trackByIndex">
      <li class="group-item item" (click)="onSelectGroupItem(option, i, j)">
        {{ item[labelBinding].trim() }}
      </li>
    </ng-container>
  </ul>
</ng-template>

<ng-template #itemListTemplate>
  <ul class="list" #listItems>
    <ng-container *ngFor="let item of options$ | async; trackBy: trackByIndex">
      <li class="item dropdown-item" (click)="onSelect(item)">
        {{ item[labelBinding].trim() }}
      </li>
    </ng-container>
  </ul>
</ng-template>
